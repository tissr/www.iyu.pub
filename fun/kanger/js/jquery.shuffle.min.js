!function (t) {
    "function" == typeof define && define.amd ? define(["jquery", "modernizr"], t) : "object" == typeof exports ? module.exports = t(require("jquery"), window.Modernizr) : window.Shuffle = t(window.jQuery, window.Modernizr)
}(function (t, e, i) {
    "use strict";
    function s(t) {
        return t ? t.replace(/([A-Z])/g, function (t, e) {
            return "-" + e.toLowerCase()
        }).replace(/^ms-/, "-ms-") : ""
    }

    function n(e, i, s) {
        var n, o, r, a = null, l = 0;
        s = s || {};
        var h = function () {
            l = s.leading === !1 ? 0 : t.now(), a = null, r = e.apply(n, o), n = o = null
        };
        return function () {
            var u = t.now();
            l || s.leading !== !1 || (l = u);
            var p = i - (u - l);
            return n = this, o = arguments, 0 >= p || p > i ? (clearTimeout(a), a = null, l = u, r = e.apply(n, o), n = o = null) : a || s.trailing === !1 || (a = setTimeout(h, p)), r
        }
    }

    function o(t, e, i) {
        for (var s = 0, n = t.length; n > s; s++)if (e.call(i, t[s], s, t) === {})return
    }

    function r(e, i, s) {
        return setTimeout(t.proxy(e, i), s)
    }

    function a(t) {
        return Math.max.apply(Math, t)
    }

    function l(t) {
        return Math.min.apply(Math, t)
    }

    function h(e) {
        return t.isNumeric(e) ? e : 0
    }

    function u(t) {
        var e, i, s = t.length;
        if (!s)return t;
        for (; --s;)i = Math.floor(Math.random() * (s + 1)), e = t[i], t[i] = t[s], t[s] = e;
        return t
    }

    if ("object" != typeof e)throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");
    var p = e.prefixed("transition"), d = e.prefixed("transitionDelay"), c = e.prefixed("transitionDuration"), f = {
        WebkitTransition: "webkitTransitionEnd",
        transition: "transitionend"
    }[p], m = e.prefixed("transform"), y = s(m), _ = e.csstransforms && e.csstransitions, g = e.csstransforms3d, v = !!window.getComputedStyle, C = "shuffle", T = "all", S = "groups", F = 1, b = .001, E = window.getComputedStyle || function () {
        }, I = function (t, e) {
        this.x = h(t), this.y = h(e)
    };
    I.equals = function (t, e) {
        return t.x === e.x && t.y === e.y
    };
    var w = function () {
        if (!v)return !1;
        var t = document.body || document.documentElement, e = document.createElement("div");
        e.style.cssText = "width:10px;padding:2px;-webkit-box-sizing:border-box;box-sizing:border-box;", t.appendChild(e);
        var i = E(e, null).width, s = "10px" === i;
        return t.removeChild(e), s
    }(), z = 0, D = t(window), $ = function (e, i) {
        i = i || {}, t.extend(this, $.options, i, $.settings), this.$el = t(e), this.element = e, this.unique = "shuffle_" + z++, this._fire($.EventType.LOADING), this._init(), r(function () {
            this.initialized = !0, this._fire($.EventType.DONE)
        }, this, 16)
    };
    return $.EventType = {
        LOADING: "loading",
        DONE: "done",
        LAYOUT: "layout",
        REMOVED: "removed"
    }, $.ClassName = {
        BASE: C,
        SHUFFLE_ITEM: "shuffle-item",
        FILTERED: "filtered",
        CONCEALED: "concealed"
    }, $.options = {
        group: T,
        speed: 250,
        easing: "ease-out",
        itemSelector: "",
        sizer: null,
        gutterWidth: 0,
        columnWidth: 0,
        delimeter: null,
        buffer: 0,
        columnThreshold: v ? .01 : .1,
        initialSort: null,
        throttle: n,
        throttleTime: 300,
        sequentialFadeDelay: 150,
        supported: _
    }, $.settings = {
        useSizer: !1,
        itemCss: {position: "absolute", top: 0, left: 0, visibility: "visible"},
        revealAppendedDelay: 300,
        lastSort: {},
        lastFilter: T,
        enabled: !0,
        destroyed: !1,
        initialized: !1,
        _animations: [],
        _transitions: [],
        _isMovementCanceled: !1,
        styleQueue: []
    }, $.Point = I, $._getItemTransformString = function (t, e) {
        return g ? "translate3d(" + t.x + "px, " + t.y + "px, 0) scale3d(" + e + ", " + e + ", 1)" : "translate(" + t.x + "px, " + t.y + "px) scale(" + e + ")"
    }, $._getNumberStyle = function (e, i, s) {
        if (v) {
            s = s || E(e, null);
            var n = $._getFloat(s[i]);
            return w || "width" !== i ? w || "height" !== i || (n += $._getFloat(s.paddingTop) + $._getFloat(s.paddingBottom) + $._getFloat(s.borderTopWidth) + $._getFloat(s.borderBottomWidth)) : n += $._getFloat(s.paddingLeft) + $._getFloat(s.paddingRight) + $._getFloat(s.borderLeftWidth) + $._getFloat(s.borderRightWidth), n
        }
        return $._getFloat(t(e).css(i))
    }, $._getFloat = function (t) {
        return h(parseFloat(t))
    }, $._getOuterWidth = function (t, e) {
        var i = E(t, null), s = $._getNumberStyle(t, "width", i);
        if (e) {
            var n = $._getNumberStyle(t, "marginLeft", i), o = $._getNumberStyle(t, "marginRight", i);
            s += n + o
        }
        return s
    }, $._getOuterHeight = function (t, e) {
        var i = E(t, null), s = $._getNumberStyle(t, "height", i);
        if (e) {
            var n = $._getNumberStyle(t, "marginTop", i), o = $._getNumberStyle(t, "marginBottom", i);
            s += n + o
        }
        return s
    }, $._skipTransition = function (t, e, i) {
        var s = t.style[c];
        t.style[c] = "0ms", e.call(i);
        var n = t.offsetWidth;
        n = null, t.style[c] = s
    }, $.prototype._init = function () {
        this.$items = this._getItems(), this.sizer = this._getElementOption(this.sizer), this.sizer && (this.useSizer = !0), this.$el.addClass($.ClassName.BASE), this._initItems(), D.on("resize." + C + "." + this.unique, this._getResizeFunction());
        var t = this.$el.css(["position", "overflow"]), e = $._getOuterWidth(this.element);
        this._validateStyles(t), this._setColumns(e), this.shuffle(this.group, this.initialSort), this.supported && r(function () {
            this._setTransitions(), this.element.style[p] = "height " + this.speed + "ms " + this.easing
        }, this)
    }, $.prototype._getResizeFunction = function () {
        var e = t.proxy(this._onResize, this);
        return this.throttle ? this.throttle(e, this.throttleTime) : e
    }, $.prototype._getElementOption = function (t) {
        return "string" == typeof t ? this.$el.find(t)[0] || null : t && t.nodeType && 1 === t.nodeType ? t : t && t.jquery ? t[0] : null
    }, $.prototype._validateStyles = function (t) {
        "static" === t.position && (this.element.style.position = "relative"), "hidden" !== t.overflow && (this.element.style.overflow = "hidden")
    }, $.prototype._filter = function (t, e) {
        t = t || this.lastFilter, e = e || this.$items;
        var i = this._getFilteredSets(t, e);
        return this._toggleFilterClasses(i.filtered, i.concealed), this.lastFilter = t, "string" == typeof t && (this.group = t), i.filtered
    }, $.prototype._getFilteredSets = function (e, i) {
        var s = t(), n = t();
        return e === T ? s = i : o(i, function (i) {
            var o = t(i);
            this._doesPassFilter(e, o) ? s = s.add(o) : n = n.add(o)
        }, this), {filtered: s, concealed: n}
    }, $.prototype._doesPassFilter = function (e, i) {
        if (t.isFunction(e))return e.call(i[0], i, this);
        var s = i.data(S), n = this.delimeter && !t.isArray(s) ? s.split(this.delimeter) : s;
        return t.inArray(e, n) > -1
    }, $.prototype._toggleFilterClasses = function (t, e) {
        t.removeClass($.ClassName.CONCEALED).addClass($.ClassName.FILTERED), e.removeClass($.ClassName.FILTERED).addClass($.ClassName.CONCEALED)
    }, $.prototype._initItems = function (t) {
        t = t || this.$items, t.addClass([$.ClassName.SHUFFLE_ITEM, $.ClassName.FILTERED].join(" ")), t.css(this.itemCss).data("point", new I).data("scale", F)
    }, $.prototype._updateItemCount = function () {
        this.visibleItems = this._getFilteredItems().length
    }, $.prototype._setTransition = function (t) {
        t.style[p] = y + " " + this.speed + "ms " + this.easing + ", opacity " + this.speed + "ms " + this.easing
    }, $.prototype._setTransitions = function (t) {
        t = t || this.$items, o(t, function (t) {
            this._setTransition(t)
        }, this)
    }, $.prototype._setSequentialDelay = function (t) {
        this.supported && o(t, function (t, e) {
            t.style[d] = "0ms," + (e + 1) * this.sequentialFadeDelay + "ms"
        }, this)
    }, $.prototype._getItems = function () {
        return this.$el.children(this.itemSelector)
    }, $.prototype._getFilteredItems = function () {
        return this.$items.filter("." + $.ClassName.FILTERED)
    }, $.prototype._getConcealedItems = function () {
        return this.$items.filter("." + $.ClassName.CONCEALED)
    }, $.prototype._getColumnSize = function (e, i) {
        var s;
        return s = t.isFunction(this.columnWidth) ? this.columnWidth(e) : this.useSizer ? $._getOuterWidth(this.sizer) : this.columnWidth ? this.columnWidth : this.$items.length > 0 ? $._getOuterWidth(this.$items[0], !0) : e, 0 === s && (s = e), s + i
    }, $.prototype._getGutterSize = function (e) {
        var i;
        return i = t.isFunction(this.gutterWidth) ? this.gutterWidth(e) : this.useSizer ? $._getNumberStyle(this.sizer, "marginLeft") : this.gutterWidth
    }, $.prototype._setColumns = function (t) {
        var e = t || $._getOuterWidth(this.element), i = this._getGutterSize(e), s = this._getColumnSize(e, i), n = (e + i) / s;
        Math.abs(Math.round(n) - n) < this.columnThreshold && (n = Math.round(n)), this.cols = Math.max(Math.floor(n), 1), this.containerWidth = e, this.colWidth = s
    }, $.prototype._setContainerSize = function () {
        this.$el.css("height", this._getContainerSize())
    }, $.prototype._getContainerSize = function () {
        return a(this.positions)
    }, $.prototype._fire = function (t, e) {
        this.$el.trigger(t + "." + C, e && e.length ? e : [this])
    }, $.prototype._resetCols = function () {
        var t = this.cols;
        for (this.positions = []; t--;)this.positions.push(0)
    }, $.prototype._layout = function (t, e) {
        o(t, function (t) {
            this._layoutItem(t, !!e)
        }, this), this._processStyleQueue(), this._setContainerSize()
    }, $.prototype._layoutItem = function (e, i) {
        var s = t(e), n = s.data(), o = n.point, r = n.scale, a = {
            width: $._getOuterWidth(e, !0),
            height: $._getOuterHeight(e, !0)
        }, l = this._getItemPosition(a);
        I.equals(o, l) && r === F || (n.point = l, n.scale = F, this.styleQueue.push({
            $item: s,
            point: l,
            scale: F,
            opacity: i ? 0 : 1,
            skipTransition: i || 0 === this.speed,
            callfront: function () {
                i || s.css("visibility", "visible")
            },
            callback: function () {
                i && s.css("visibility", "hidden")
            }
        }))
    }, $.prototype._getItemPosition = function (t) {
        for (var e = this._getColumnSpan(t.width, this.colWidth, this.cols), i = this._getColumnSet(e, this.cols), s = this._getShortColumn(i, this.buffer), n = new I(Math.round(this.colWidth * s), Math.round(i[s])), o = i[s] + t.height, r = this.cols + 1 - i.length, a = 0; r > a; a++)this.positions[s + a] = o;
        return n
    }, $.prototype._getColumnSpan = function (t, e, i) {
        var s = t / e;
        return Math.abs(Math.round(s) - s) < this.columnThreshold && (s = Math.round(s)), Math.min(Math.ceil(s), i)
    }, $.prototype._getColumnSet = function (t, e) {
        if (1 === t)return this.positions;
        for (var i = e + 1 - t, s = [], n = 0; i > n; n++)s[n] = a(this.positions.slice(n, n + t));
        return s
    }, $.prototype._getShortColumn = function (t, e) {
        for (var i = l(t), s = 0, n = t.length; n > s; s++)if (t[s] >= i - e && t[s] <= i + e)return s;
        return 0
    }, $.prototype._shrink = function (e) {
        var i = e || this._getConcealedItems();
        o(i, function (e) {
            var i = t(e), s = i.data();
            s.scale !== b && (s.scale = b, this.styleQueue.push({
                $item: i,
                point: s.point,
                scale: b,
                opacity: 0,
                callback: function () {
                    i.css("visibility", "hidden")
                }
            }))
        }, this)
    }, $.prototype._onResize = function () {
        if (this.enabled && !this.destroyed) {
            var t = $._getOuterWidth(this.element);
            t !== this.containerWidth && this.update()
        }
    }, $.prototype._getStylesForTransition = function (t) {
        var e = {opacity: t.opacity};
        return this.supported ? e[m] = $._getItemTransformString(t.point, t.scale) : (e.left = t.point.x, e.top = t.point.y), e
    }, $.prototype._transition = function (e) {
        var i = this._getStylesForTransition(e);
        this._startItemAnimation(e.$item, i, e.callfront || t.noop, e.callback || t.noop)
    }, $.prototype._startItemAnimation = function (e, i, s, n) {
        function o(e) {
            e.target === e.currentTarget && (t(e.target).off(f, o), r._removeTransitionReference(a), n())
        }

        var r = this, a = {$element: e, handler: o};
        if (s(), !this.initialized)return e.css(i), void n();
        if (this.supported)e.css(i), e.on(f, o), this._transitions.push(a); else {
            var l = e.stop(!0).animate(i, this.speed, "swing", n);
            this._animations.push(l.promise())
        }
    }, $.prototype._processStyleQueue = function (e) {
        this.isTransitioning && this._cancelMovement();
        var i = t();
        o(this.styleQueue, function (t) {
            t.skipTransition ? this._styleImmediately(t) : (i = i.add(t.$item), this._transition(t))
        }, this), i.length > 0 && this.initialized && this.speed > 0 ? (this.isTransitioning = !0, this.supported ? this._whenCollectionDone(i, f, this._movementFinished) : this._whenAnimationsDone(this._movementFinished)) : e || r(this._layoutEnd, this), this.styleQueue.length = 0
    }, $.prototype._cancelMovement = function () {
        this.supported ? o(this._transitions, function (t) {
            t.$element.off(f, t.handler)
        }) : (this._isMovementCanceled = !0, this.$items.stop(!0), this._isMovementCanceled = !1), this._transitions.length = 0, this.isTransitioning = !1
    }, $.prototype._removeTransitionReference = function (e) {
        var i = t.inArray(e, this._transitions);
        i > -1 && this._transitions.splice(i, 1)
    }, $.prototype._styleImmediately = function (t) {
        $._skipTransition(t.$item[0], function () {
            t.$item.css(this._getStylesForTransition(t))
        }, this)
    }, $.prototype._movementFinished = function () {
        this.isTransitioning = !1, this._layoutEnd()
    }, $.prototype._layoutEnd = function () {
        this._fire($.EventType.LAYOUT)
    }, $.prototype._addItems = function (t, e, i) {
        this._initItems(t), this._setTransitions(t), this.$items = this._getItems(), this._shrink(t), o(this.styleQueue, function (t) {
            t.skipTransition = !0
        }), this._processStyleQueue(!0), e ? this._addItemsToEnd(t, i) : this.shuffle(this.lastFilter)
    }, $.prototype._addItemsToEnd = function (t, e) {
        var i = this._filter(null, t), s = i.get();
        this._updateItemCount(), this._layout(s, !0), e && this.supported && this._setSequentialDelay(s), this._revealAppended(s)
    }, $.prototype._revealAppended = function (e) {
        r(function () {
            o(e, function (e) {
                var i = t(e);
                this._transition({$item: i, opacity: 1, point: i.data("point"), scale: F})
            }, this), this._whenCollectionDone(t(e), f, function () {
                t(e).css(d, "0ms"), this._movementFinished()
            })
        }, this, this.revealAppendedDelay)
    }, $.prototype._whenCollectionDone = function (e, i, s) {
        function n(e) {
            e.target === e.currentTarget && (t(e.target).off(i, n), o++, o === r && (a._removeTransitionReference(l), s.call(a)))
        }

        var o = 0, r = e.length, a = this, l = {$element: e, handler: n};
        e.on(i, n), this._transitions.push(l)
    }, $.prototype._whenAnimationsDone = function (e) {
        t.when.apply(null, this._animations).always(t.proxy(function () {
            this._animations.length = 0, this._isMovementCanceled || e.call(this)
        }, this))
    }, $.prototype.shuffle = function (t, e) {
        this.enabled && (t || (t = T), this._filter(t), this._updateItemCount(), this._shrink(), this.sort(e))
    }, $.prototype.sort = function (t) {
        if (this.enabled) {
            this._resetCols();
            var e = t || this.lastSort, i = this._getFilteredItems().sorted(e);
            this._layout(i), this.lastSort = e
        }
    }, $.prototype.update = function (t) {
        this.enabled && (t || this._setColumns(), this.sort())
    }, $.prototype.layout = function () {
        this.update(!0)
    }, $.prototype.appended = function (t, e, i) {
        this._addItems(t, e === !0, i !== !1)
    }, $.prototype.disable = function () {
        this.enabled = !1
    }, $.prototype.enable = function (t) {
        this.enabled = !0, t !== !1 && this.update()
    }, $.prototype.remove = function (e) {
        function i() {
            e.remove(), this.$items = this._getItems(), this._updateItemCount(), this._fire($.EventType.REMOVED, [e, this]), e = null
        }

        e.length && e.jquery && (this._toggleFilterClasses(t(), e), this._shrink(e), this.sort(), this.$el.one($.EventType.LAYOUT + "." + C, t.proxy(i, this)))
    }, $.prototype.destroy = function () {
        D.off("." + this.unique), this.$el.removeClass(C).removeAttr("style").removeData(C), this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([$.ClassName.CONCEALED, $.ClassName.FILTERED, $.ClassName.SHUFFLE_ITEM].join(" ")), this.$items = null, this.$el = null, this.sizer = null, this.element = null, this._transitions = null, this.destroyed = !0
    }, t.fn.shuffle = function (e) {
        var i = Array.prototype.slice.call(arguments, 1);
        return this.each(function () {
            var s = t(this), n = s.data(C);
            n ? "string" == typeof e && n[e] && n[e].apply(n, i) : (n = new $(this, e), s.data(C, n))
        })
    }, t.fn.sorted = function (e) {
        var s = t.extend({}, t.fn.sorted.defaults, e), n = this.get(), o = !1;
        return n.length ? s.randomize ? u(n) : (t.isFunction(s.by) && n.sort(function (e, n) {
            if (o)return 0;
            var r = s.by(t(e)), a = s.by(t(n));
            return r === i && a === i ? (o = !0, 0) : a > r || "sortFirst" === r || "sortLast" === a ? -1 : r > a || "sortLast" === r || "sortFirst" === a ? 1 : 0
        }), o ? this.get() : (s.reverse && n.reverse(), n)) : []
    }, t.fn.sorted.defaults = {reverse: !1, by: null, randomize: !1}, $
});